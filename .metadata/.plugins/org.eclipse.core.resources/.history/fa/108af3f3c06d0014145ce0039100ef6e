module SIGModelMetrics::OveralSize
import Prelude;
import String;

//Java Parsing libraries
import lang::java::m3::Core;
import lang::java::jdt::m3::Core;

//Utility Libraries
import SIGModelMetrics::Lib::StringCleaning;
import SIGModelMetrics::Lib::CodeCleaning;

map[ int, str ] systemSizeRisk = (
	0 		: "++",
	66000 	: "+",
	246000  : "o",
	655000  : "-",
	1310000 : "--"
);

public void insertProject(loc project)
{
 	model =  createM3FromEclipseProject(project);
 	overalVolumeMetric(model);	
}

public void overalVolumeMetric(M3 projectModel)
{
	println("calculating lines of codes of project...");	
	
	linOCode = projectLinesOfCode(projectModel); 
	
	println("Done!");
	println("total lines of code: <linOCode>");
	
	println("System risk due to overal volume:");
	if(linOCode > systemSizeRisk[4])
		println("-- (very high)");
	if(linOCode > systemSizeRisk[3])
		println("-- (high)");
	if(linOCode > systemSizeRisk[2])
		println("-- (medium)");
	if(linOCode > systemSizeRisk[1])
		println("-- (low)");
	if(linOCode > systemSizeRisk[0])
		println("-- (very low)");	
}

private int projectLinesOfCode(M3 model)
{
	files  = files(model); 			     //location of all the files in the project
	docLoc = range(model@documentation); //location of all the documentation in the project
    
    int totalLines = 0; 
    
    //calculate the lines of code for each file  
    for(file <- files)
    {	    
    	docsInFile = {doc | doc <- docLoc, file.path == doc.path};
    	cleanFile = filterDocInFile(model, file, docsInFile);
    	totalLines = totalLines + size(split("\r\n", cleanFile));	
    }
    return totalLines;
}